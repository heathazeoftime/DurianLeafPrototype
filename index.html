Masukin fungsi tadi ke kode ini:

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Durian Disease Monitoring â€” Dashboard</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Chart.js for graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* ========== GLOBAL THEME (Dark) ========== */
body {
    margin: 0;
    padding: 20px 0 40px;
    background: #0d1117;
    font-family: "Inter", sans-serif;
    color: #e6edf3;
    display: flex;
    flex-direction: column;
    align-items: center;
}

h1 {
    margin: 10px 0 5px;
    font-size: 28px;
    font-weight: 600;
    color: #58a6ff;
}
.subtitle { font-size: 14px; color: #8b949e; }

.main-layout {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
    justify-content: center;
}

/* ========== CARD ========== */
.card {
    background: #161b22;
    padding: 18px 20px;
    border-radius: 14px;
    border: 1px solid #30363d;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
}
.live-card { width: 360px; }
.history-card { width: 360px; }

/* IMAGE + BBOX */
#imageContainer {
    width: 320px;
    height: 240px;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
    border: 1px solid #30363d;
    background: #0d1117;
}
#cameraImage { width: 100%; height: 100%; object-fit: cover; }
#bbox {
    position: absolute;
    border: 3px solid #ff4d4d;
    border-radius: 3px;
    pointer-events: none;
    transition: 0.15s ease-in-out;
}

/* INFO PANEL */
.labelTag {
    display: inline-block;
    background: #1f6feb;
    padding: 2px 8px;
    border-radius: 6px;
    font-weight: 600;
}

/* STATUS */
.statusBadge {
    width: 10px; height: 10px;
    border-radius: 50%;
    margin-left: 6px;
    display: inline-block;
}
#statusConnected { background: #2ea043; }
#statusWaiting { background: #d29922; }
.hidden { display: none; }

/* SEVERITY COLORS */
.conf-green  { background:#238636; padding:2px 8px; border-radius:6px; font-weight:600; }
.conf-yellow { background:#d29922; padding:2px 8px; border-radius:6px; font-weight:600; }
.conf-red    { background:#da3633; padding:2px 8px; border-radius:6px; font-weight:600; }

/* HISTORY */
#historyList {
    margin-top: 8px;
    max-height: 320px;
    overflow-y: auto;
}
.history-item {
    display: flex;
    align-items: center;
    padding: 6px;
    margin-bottom: 6px;
    border-radius: 8px;
    border: 1px solid #30363d;
    background: #0d1117;
    cursor: pointer;
}
.history-item:hover { background:#21262d; transform:translateY(-1px); }
.history-thumb {
    width: 64px; height: 48px;
    border-radius: 5px;
    object-fit: cover;
    margin-right: 8px;
    border: 1px solid #30363d;
}

#clearHistoryBtn {
    margin-bottom: 10px;
    padding: 6px 12px;
    background: #da3633;
    border: 1px solid #f85149;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
}
</style>
</head>

<body>

<h1>Durian Disease Monitoring</h1>
<div class="subtitle">Live detection Â· History Â· Analytics</div>

<div class="main-layout">

    <!-- LIVE VIEW -->
    <div class="card live-card">
        <h3 style="margin:0 0 8px;">Live View</h3>
        <div id="imageContainer">
            <img id="cameraImage" src="">
            <div id="bbox"></div>
        </div>

        <div id="infoPanel">
            Status:
            <span id="statusWaiting" class="statusBadge"></span>
            <span id="statusConnected" class="statusBadge hidden"></span>

            <div style="margin-top: 8px;">
                Label: <span id="label" class="labelTag">-</span><br>
                Confidence: <span id="confidence">-</span><br>
                Last Update: <span id="timestamp">-</span>
            </div>
        </div>
    </div>

    <!-- HISTORY -->
    <div class="card history-card">
        <div class="history-title">History (latest detections)</div>

        <button id="clearHistoryBtn">Clear History</button>
        <div id="historyList"></div>
    </div>

</div>

<!-- CONFIDENCE VS TIME GRAPH -->
<div class="card" style="width:760px; margin-top:20px;">
    <h3 style="margin:0 0 10px;">Confidence vs Time</h3>
    <canvas id="confidenceChart" width="720" height="300"></canvas>
</div>


<script>
// =======================
// FIREBASE CONFIG
// =======================
firebase.initializeApp({
    apiKey: "YOUR_API_KEY",
    authDomain: "duriandiseasemonitoring.firebaseapp.com",
    databaseURL: "https://duriandiseasemonitoring-default-rtdb.firebaseio.com",
    projectId: "duriandiseasemonitoring",
});

// Firebase refs
const latestRef  = firebase.database().ref("detections/latest");
const historyRef = firebase.database().ref("detections/history").limitToLast(20);

// UI
const imgEl   = document.getElementById("cameraImage");
const bboxEl  = document.getElementById("bbox");
const confEl  = document.getElementById("confidence");
const labelEl = document.getElementById("label");
const timeEl  = document.getElementById("timestamp");
const statusWaiting   = document.getElementById("statusWaiting");
const statusConnected = document.getElementById("statusConnected");
const historyListEl   = document.getElementById("historyList");

// Status badge
function setStatus(ok) {
    if (ok) {
        statusConnected.classList.remove("hidden");
        statusWaiting.classList.add("hidden");
    } else {
        statusWaiting.classList.remove("hidden");
        statusConnected.classList.add("hidden");
    }
}

// ============================
// LIVE LISTENER + SEVERITY
// ============================
latestRef.on("value", (snap) => {
    if (!snap.exists()) { setStatus(false); return; }

    const d = snap.val();
    setStatus(true);

    if (d.image_b64) {
        imgEl.src = "data:image/jpeg;base64," + d.image_b64;
    }

    labelEl.textContent = d.label || "-";

    confEl.classList.remove("conf-green","conf-yellow","conf-red");
    if (typeof d.confidence === "number") {
        const p = d.confidence;
        confEl.textContent = (p * 100).toFixed(1) + "%";

        if (p >= 0.85) confEl.classList.add("conf-red");
        else if (p >= 0.6) confEl.classList.add("conf-yellow");
        else confEl.classList.add("conf-green");
    }

    timeEl.textContent = new Date().toLocaleTimeString();

    if (typeof d.x === "number") {
        bboxEl.style.left = d.x + "px";
        bboxEl.style.top = d.y + "px";
        bboxEl.style.width = d.width + "px";
        bboxEl.style.height = d.height + "px";
    }
});

// ==========================================
// HISTORY LISTENER + UPDATE ON-CLICK PREVIEW
// ==========================================
historyRef.on("value", (snap) => {
    historyListEl.innerHTML = "";

    if (!snap.exists()) {
        historyListEl.innerHTML = "<div class='history-time'>No history yet.</div>";
        return;
    }

    snap.forEach((childSnap) => {
        const d = childSnap.val();
        if (!d.image_b64) return;

        const item = document.createElement("div");
        item.className = "history-item";

        const img = document.createElement("img");
        img.className = "history-thumb";
        img.src = "data:image/jpeg;base64," + d.image_b64;

        const meta = document.createElement("div");
        meta.className = "history-meta";

        let severity = "ðŸŸ¢ Normal";
        if (d.confidence >= 0.85) severity = "ðŸ”´ Severe";
        else if (d.confidence >= 0.6) severity = "ðŸŸ¡ Medium";

        meta.innerHTML = `
            <div class="history-label">${d.label || "-"}</div>
            <div class="history-confidence">${severity} â€¢ ${(d.confidence*100).toFixed(1)}%</div>
            <div class="history-time">Click to preview</div>
        `;

        item.append(img, meta);

        item.addEventListener("click", () => {
            imgEl.src = img.src;
            labelEl.textContent = d.label;

            confEl.classList.remove("conf-green","conf-yellow","conf-red");
            if (d.confidence >= 0.85) confEl.classList.add("conf-red");
            else if (d.confidence >= 0.6) confEl.classList.add("conf-yellow");
            else confEl.classList.add("conf-green");

            confEl.textContent = (d.confidence * 100).toFixed(1) + "%";
            timeEl.textContent = "from history";

            bboxEl.style.left = d.x + "px";
            bboxEl.style.top = d.y + "px";
            bboxEl.style.width = d.width + "px";
            bboxEl.style.height = d.height + "px";
        });

        historyListEl.appendChild(item);
    });
});

// ============================
// CLEAR HISTORY
// ============================
document.getElementById("clearHistoryBtn")
.addEventListener("click", () => {
    if (!confirm("Hapus semua history?")) return;
    firebase.database().ref("detections/history").remove();
});

// ============================
// CONFIDENCE TIME SERIES CHART
// ============================
const ctx = document.getElementById("confidenceChart").getContext("2d");

const confidenceChart = new Chart(ctx, {
    type: "line",
    data: {
        labels: [],
        datasets: [{
            label: "Confidence (%)",
            data: [],
            borderColor: "#58a6ff",
            backgroundColor: "rgba(88, 166, 255, 0.25)",
            borderWidth: 2,
            tension: 0.22,
            pointRadius: 3
        }]
    },
    options: {
        plugins: {
            legend: { labels: { color: "#e6edf3" } }
        },
        scales: {
            x: {
                ticks: { color: "#8b949e" }
            },
            y: {
                min: 0, max: 100,
                ticks: { color: "#8b949e" }
            }
        }
    }
});

// Update chart when history changes
historyRef.on("value", (snap) => {
    const labels = [];
    const values = [];

    if (snap.exists()) {
        snap.forEach((child) => {
            const d = child.val();
            if (typeof d.confidence === "number") {
                labels.push(new Date(d.timestamp).toLocaleTimeString());
                values.push((d.confidence * 100).toFixed(1));
            }
        });
    }

    confidenceChart.data.labels = labels;
    confidenceChart.data.datasets[0].data = values;
    confidenceChart.update();
});
</script>

</body>
</html>
